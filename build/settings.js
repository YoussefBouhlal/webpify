(()=>{"use strict";var e={n:t=>{var i=t&&t.__esModule?()=>t.default:()=>t;return e.d(i,{a:i}),i},d:(t,i)=>{for(var n in i)e.o(i,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:i[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.domReady;var i=e.n(t);const n=window.wp.element,a=window.wp.apiFetch;var s=e.n(a);const o=window.wp.data,l=window.wp.notices,r=window.wp.i18n,c=window.wp.components,p=window.ReactJSXRuntime,d=()=>{const{removeNotice:e}=(0,o.useDispatch)(l.store),t=(0,o.useSelect)(e=>e(l.store).getNotices());return 0===t.length?null:(0,p.jsx)(c.NoticeList,{notices:t,onRemove:e})},_=({format:e,setFormat:t})=>(0,p.jsx)(c.PanelBody,{title:(0,r.__)("General settings","webpify"),children:(0,p.jsx)("div",{className:"webpify-settings__field-container",children:(0,p.jsx)(c.SelectControl,{__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0,label:(0,r.__)("Format","webpify"),value:e,options:[{label:(0,r.__)("WebP","webpify"),value:"1"},{label:(0,r.__)("AVIF","webpify"),value:"2"}],onChange:t})})}),w=({display:e,setDisplay:t,startBulkOptimization:i,stopBulkOptimization:n,startBulk:a})=>(0,p.jsxs)(c.PanelBody,{title:(0,r.__)("Bulk settings","webpify"),children:[(0,p.jsx)("div",{className:"webpify-settings__field-container",children:(0,p.jsx)(c.RadioControl,{label:(0,r.__)("Display images with new format on the site","webpify"),selected:e,options:[{label:(0,r.__)("Deactivate","webpify"),value:"1"},{label:(0,r.__)("Use <picture> tags","webpify"),value:"2"},{label:(0,r.__)("Use rewrite rules","webpify"),value:"3"}],onChange:t})}),(0,p.jsx)(c.PanelRow,{children:(0,p.jsxs)("div",{className:"webpify-settings__field-container",children:[(0,p.jsx)("div",{className:"webpify-settings__button__label",children:(0,r.__)("Bulk optimization","webpify")}),a?(0,p.jsx)(c.Button,{isDestructive:!0,variant:"secondary",onClick:n,__next40pxDefaultSize:!0,children:(0,r.__)("Stop","webpify")}):(0,p.jsx)(c.Button,{variant:"secondary",onClick:i,__next40pxDefaultSize:!0,children:(0,r.__)("Start","webpify")})]})})]}),u=({saveSettings:e})=>(0,p.jsx)(c.PanelBody,{children:(0,p.jsx)(c.Button,{variant:"primary",onClick:e,__next40pxDefaultSize:!0,children:(0,r.__)("Save","webpify")})}),{optionName:f,ajaxUrl:y,nonce:m}=WEBPIFY_SETTINGS,b=()=>{const[e,t]=(0,n.useState)(),[i,a]=(0,n.useState)(),[b,h]=(0,n.useState)(),{createSuccessNotice:x,createErrorNotice:g,removeNotice:v}=(0,o.useDispatch)(l.store);return(0,n.useEffect)(()=>{s()({path:"/wp/v2/settings"}).then(e=>{const i=e.webpify_settings;t(i.format),a(i.display)})},[]),(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(d,{}),(0,p.jsxs)(c.Panel,{children:[(0,p.jsx)(_,{format:e,setFormat:t}),(0,p.jsx)(w,{display:i,setDisplay:a,stopBulkOptimization:()=>{h(!1);const e=new FormData;e.append("action","webpify_bulk_optimization_end"),e.append("_wpnonce",m),fetch(y,{method:"POST",body:e}).then(e=>e.json()).then(e=>{console.log(e)}).catch(e=>{console.log(e)})},startBulkOptimization:()=>{h(!0);const e=new FormData;e.append("action","webpify_bulk_optimization_start"),e.append("_wpnonce",m),fetch(y,{method:"POST",body:e}).then(e=>e.json()).then(e=>{console.log(e)}).catch(e=>{console.log(e)})},startBulk:b}),(0,p.jsx)(u,{saveSettings:()=>{wp.data.select(l.store).getNotices().forEach(e=>v(e.id)),s()({path:"/wp/v2/settings",method:"POST",data:{[f]:{format:e,display:i}}}).then(()=>{x((0,r.__)("Settings saved","webpify"))}).catch(e=>{g(e.message)})}})]})]})};i()(()=>{(0,n.createRoot)(document.getElementById("JS-webpify-settings")).render((0,p.jsx)(b,{}))})})();